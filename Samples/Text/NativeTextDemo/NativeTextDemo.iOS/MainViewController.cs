// This file has been autogenerated from a class added in the UI designer.

using System;
using System.Collections.Generic;
using GalaSoft.MvvmLight.Helpers;
using NativeTextDemo.ViewModel;
using Styles.Text;
using UIKit;

namespace NativeTextDemo.iOS
{
    public partial class MainViewController : UIViewController
    {
        StyleManager styleManager;
        IManagedStyle styleOne;
        IManagedStyle styleTwo;
        IManagedStyle styleThree;
        IManagedStyle styleBody;
        IManagedStyle styleEntry;


        // Keep track of bindings to avoid premature garbage collection
        readonly List<Binding> bindings = new List<Binding>();
        MainViewModel Vm
        {
            get
            {
                return ViewModelLocator.Main;
            }
        }

        public MainViewController(IntPtr handle) : base(handle)
        {
        }

        public override void ViewDidLoad()
        {
            base.ViewDidLoad();

            refreshButton.Clicked += RefreshButton_Clicked;

            styleManager = new StyleManager();
            styleOne = styleManager.Add(titleOne, TextStyles.H2);
            styleTwo = styleManager.Add(titleTwo, TextStyles.H1);
            styleThree = styleManager.Add(titleThree, TextStyles.H2);
            styleThree.AutoUpdate = true;
            styleBody = styleManager.Add(textBody, TextStyles.Body);
            styleEntry = styleManager.Add(textEntry, TextStyles.Body);
            styleEntry.EnableHtmlEditing = true;

            bindings.Add(
                this.SetBinding(
                    () => ViewModelLocator.Styles.CustomTags,
                    () => styleManager.CustomTags
                )
            );

            bindings.Add(
                this.SetBinding(
                    () => Vm.TitleOne,
                    () => styleOne.Text
                )
            );

            bindings.Add(
                this.SetBinding(
                    () => Vm.TitleTwo,
                    () => styleTwo.Text
                )
            );

            bindings.Add(
                this.SetBinding(
                    () => Vm.TitleThree,
                    () => styleThree.Text
                )
            );

            bindings.Add(
                this.SetBinding(
                    () => Vm.Body,
                    () => styleBody.Text
                )
            );

            bindings.Add(
                this.SetBinding(
                    () => Vm.Entry,
                    () => styleEntry.Text
                )
            );

            Xamarin.IQKeyboardManager.SharedManager.EnableAutoToolbar = true;
            Xamarin.IQKeyboardManager.SharedManager.ShouldResignOnTouchOutside = true;

            var touchGesture = new UITapGestureRecognizer(HandleAction);
            View.AddGestureRecognizer(touchGesture);
        }

        void RefreshButton_Clicked(object sender, EventArgs e)
        {
            if (Vm != null)
            {
                ViewModelLocator.Styles.RefreshCommand.Execute(null);
            }
        }

        void HandleAction()
        {
            if (textEntry.IsEditing)
                View.EndEditing(true);
        }
    }
}
